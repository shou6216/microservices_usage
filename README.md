# マイクロサービス学習用プロジェクト

## 目的

* 概念や思想をちゃんと理解する
* 不向きな部分、デメリットも抑える
* Spring Framework、AWSの構築方法を習得する

## マイクロサービス

### 1. マイクロサービスとは

* **ビジネスドメインに基づいてモデル化** された、 **独立してデプロイ可能** なサービス
* サービス同士はネットワークを介して相互に通信
* サービス指向アーキテクチャ（SOA）の一種
* **新しい技術を使う必要はない。** どんな言語で、どんなプラットフォームでも良い

#### 1.1. 独立デプロイ可能性

* 他のサービスに影響を与えることなくデプロイできる
* サービス同士が疎結合

#### 1.2. ビジネスモデルに基づくモデル化

##### モノリシック（従来は）

* 3層アーキテクチャ（Web、App、DB）に対して、層ごと開発チームを形成していた
    * 機能ではなく技術のまとまりでチームを形成
    * DBは機能やチーム間で共有することが多いため、変更の影響が大きい

##### マイクロサービス

* 技術ではなく機能のまとまりでチームを形成する
* サービスのカプセル化が可能
    * サービス内に小さな3層アーキテクチャができる   
    * 他サービスへの影響を減らし、変更が容易になる
    * **DBの共有は、独立デプロイ可能性を実現するうえで一番の弊害**

#### 1.3. マイクロサービスの利点

* 各サービスの作業を並行して行える
* 1機能=1サービスなので、担当サービスの理解が容易
* サービスごと異なる言語、DB、開発手法の選択が可能

#### 1.4. マイクロサービスの課題

* サービス間のやりとりがネットワーク通信になるため、レイテンシーやネットワーク障害をより考慮する必要がある

#### 1.5. マイクロサービスのポイント

* 段階的にマイクロサービス化する。一気に大量のマイクロサービスを作らない
* 1サービスは小規模で
* 技術単位ではなく、機能単位の組織づくり
    * プロダクトオーナーや運用チームは、各々サービスチームごと配置
    * それらサービスを束ねる技術リーダーは別途設ける

### [2. モノリス（モノリシック）とは](doc/2.monolithic.md)

### [3. 結合と凝集](doc/3.coupling_cohesion.md)

### [4. 移行計画](doc/4.migration_plan.md)

### [5. モノリスの分割](doc/5.monolithic_division.md)

### [6. データベースの分割](doc/6.database_division.md)

### 6.10. 破壊的変更

#### 概要

* マイクロサービスの利用側に影響を与えないようにする必要がある
* 影響ないと思ってがっつり変えて本番環境にデプロイしたら、多機能に影響出たとか最悪
    *  もともとパラメータ2つだったけど、3つにした
    *  返すデータ構造を変えた
* マイクロサービスやチームの数が増えれば増えるほど、この問題は顕在化する

#### 対策

* テストを頻繁に行うことが最良の検出方法
* 変更を加えたら（検出したら）関係者に素早く周知すること
* そもそも破壊的変更で環なく、拡張する形に変更ができないか検討
* 変更前後のマイクロサービスを同時稼働させる
   * 変更後のデプロイ環境追加、変更前後の利用データ互換性など意識すべきことが増えて結構負担
* 1つのマイクロサービス内で互換性を持たせる
   * マイクロサービス内に変更前後のAPIを両方持つ

### 6.11. 監視

* ログや監視は、モノリスに比べて見るべきプロセスが増える
* どちらにせよ、1つのサービスに集約することが望ましい（ログ収集マイクロサービスなど）
   * 各マイクロサービスを利用する際にゲートウェイ的なものを通せば、収集が可能

### 6.12. 開発方法

#### 概要

* マイクロサービスいっぱいあると、開発対象のサービスを作るためにいくつかのマイクロサービスが必要
* 所有する開発PCで全部起動できなくなる

#### 対策

* スタブ化する
* 別サーバで立てたサービスを利用する
* **Telepresence** ってのがうまい具合にマイクロサービスを管理してくれるっぽい
* 本番環境では、 **Kubertetes** など使って管理するのが良い

5.8. aaaa TODO
5.9. aaaa
5.10. aaaa
5.11. aaaa
5.12. aaaa

### fff

## 構築

### Spring Framework

### AWS

## 参考
